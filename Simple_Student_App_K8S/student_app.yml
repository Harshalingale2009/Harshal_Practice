#---------MariaDB---------
apiVersion: v1
kind: Service
metadata:
  name: mariadb
spec: 
  selector: 
    app: mariadb
  ports: 
    - port: 3306
      targetPort: 3306
  type: ClusterIP

---

apiVersion: apps/v1
kind: Deployment
metadata: 
  name: mariadb
spec:       
  selector:
    matchLabels: 
      app: mariadb
  template: 
    metadata:
      labels: 
        app: mariadb
    spec:
      containers: 
       - name: mariadb
         image: mariadb:latest
         env:
            -name: MYSQL_ROOT_PASSWORD
             value: "redhat"  
            -name: MYSQL_DATABASE
             value: "student_db"
         ports:  
          -containerPort: 3306

# --------- Backend ---------
---
apiVersion: v1
kind: Service
metadata: 
  name: Backend
spec: 
  selector: 
     app: Backend
  ports:
    -port: 8080
     TargetPort: 8080
     NodePort: 30080
  type: NodePort

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: Backend
spec: 
  selector: 
    matchLabels:
      app: Backend
  template:
    metadata:
      label:
       app: Backend
    spec: 
      containers:
        name: Backend
        image: yugajoshi/student-backend:latest
        port: 
          -containerPort: 8080
        env:
         -name: DB_HOST
          value: "MariaDB"
         -name: DB_PORT
          value: "3306"
         -name: DB_NAME
          value: "student_db"
         -name: DB_USER
          value: "root" 
         -name: DB_PASS
          value: "redhat" 


# --------- config.js for Frontend ---------
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: Frontend-config
  data:
  config.js: |
    window.APP_CONFIG = {
      API_URL: "http://54.242.214.85:30080/api"
    };

# --------- Frontend ---------
---
apiVersion: v1
kind: Service
metadata:
  name: Frontend
spec:
  selector: 
    app: Frontend
  ports:
    - port: 80
      targetPort: 80
      nodePort: 30081
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: Frontend
spec: 
  selector:
    matchLabels: 
     app: Frontend
  template:
    metadata:
     label:
      app: Frontend
    spec:
      containers:
        name: Frontend
        image: yugajoshi/student-frontend:latest
        ports:
          -containerPort: 80
        volumeMounts: 
         name: config-volume
         mountPath: /var/www/localhost/htdocs/config.js
         subPath: config.js

      volumes: 
         name: config-volume
         configMap: 
           name: frontend-config